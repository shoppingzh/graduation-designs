C51 COMPILER V9.01   MAIN                                                                  05/10/2018 14:41:01 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Dev\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE INCDIR(.\anjian;.\12864) DEBUG OBJECTEXTEND

line level    source

   1          #include "key.h"
   2          #include "pyinput.h"
   3          #include "string.h"
   4          #include "lcd12864.h"
   5          #include "intrins.h"
   6          #include "stdio.h"
   7          
   8          #define uchar unsigned char
   9          
  10          char input_buffer[8] = {0, 0, 0, 0, 0, 0, 0, 0};
  11          int input_index = 0;
  12          
  13          uchar cursor = 0;
  14          uchar line = 0;
  15          uchar pos = 1;
  16          uchar *words;
  17          
  18          //普通延时
  19          static void delay(uchar t){
  20   1              uchar i,j;
  21   1              for(i=0;i<t;i++)
  22   1                      for(j=0;j<110;j++);
  23   1      }
  24          
  25          
  26          
  27          //切割临时输入字符串，得到实际的输入字符串
  28          static char* trim(){
  29   1              char str[6];
  30   1              return strncpy(str, input_buffer, input_index);
  31   1      }
  32          
  33          //清除缓冲区
  34          static void clear_input_buffer(){
  35   1              uchar i;
  36   1              for(i=0;i<8;i++){
  37   2                      input_buffer[i] = 0;
  38   2              }
  39   1      }               
  40          
  41          void main(){
  42   1      
  43   1              //char* str;
  44   1              //char str2[15];
  45   1              //uchar c;
  46   1              py_index *matchlist[10];
  47   1      
  48   1              initlcm();
  49   1      
  50   1      //      c = get_pymb("a");
  51   1      //      sprintf(str, "%d", (int)c);
  52   1      //      displaystring(3, 0, str);
  53   1      
  54   1              while(1){
  55   2                      int key = keyscan();
C51 COMPILER V9.01   MAIN                                                                  05/10/2018 14:41:01 PAGE 2   

  56   2      
  57   2                      if(key == -1){
  58   3                              //错误
  59   3                      }else if(key == 0){
  60   3                              //确认输入当前汉字
  61   3                              uchar word[3];
  62   3                              word[0] = words[cursor];
  63   3                              word[1] = words[cursor+1];
  64   3                              word[2] = '\0';
  65   3                              
  66   3                              if(pos > 7){
  67   4                                      line = 1;
  68   4                                      pos = 0;
  69   4                              }
  70   3                              displaystring(line, pos++, word);                       
  71   3      
  72   3                              clear_input_buffer();
  73   3                              input_index = 0;
  74   3                              cursor = 0;
  75   3                              
  76   3                              clearline(2);                           
  77   3                              clearline(3);                           
  78   3                      }else if(key == 10){
  79   3                              //备选汉字列表左移一位
  80   3                              cursor -= 2;                    
  81   3                      }else if(key == 11){
  82   3                              //备选汉字列表右移一位
  83   3                              cursor += 2;
  84   3                              
  85   3                      }else{
  86   3                              if(input_index > 5){
  87   4                                      continue;
  88   4                              }
  89   3      
  90   3                              //正在输入，获取输入的拼音和汉字
  91   3                              input_buffer[input_index++] = key + 48;
  92   3                              get_matched_pymb(input_buffer, matchlist);
  93   3      
  94   3                              words =  matchlist[0][0].pymb;
  95   3      
  96   3                              clearline(2);
  97   3                              displaystring(2, 0,  matchlist[0][0].py);
  98   3                              
  99   3                              displaystring(3, 0,  matchlist[0][0].pymb);
 100   3                              
 101   3                      }
 102   2      
 103   2                      //显示
 104   2              }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    409    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     16      41
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

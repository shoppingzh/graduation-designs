C51 COMPILER V9.01   MAIN                                                                  05/07/2018 15:41:16 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\Outputs\main.obj
COMPILER INVOKED BY: D:\Dev\Keil\C51\BIN\C51.EXE ..\User\main.c BROWSE INCDIR(..\User,..\Hardware) DEBUG OBJECTEXTEND PR
                    -INT(.\main.lst) OBJECT(..\Outputs\main.obj)

line level    source

   1          #include "reg51.h"
   2          #include "lcd1602.h"
   3          #include "adc.h"
   4          #include "intrins.h"
   5          #include "stdio.h"
   6          
   7          #define uchar unsigned char
   8          #define uint unsigned int
   9          
  10          char idx = 0;
  11          code uchar cs[] = {0xfc, 0xf9, 0xf3, 0xf6};
  12          
  13          sbit led_add = P3^6;
  14          sbit led_addend = P3^7;
  15          
  16          //转动
  17          void roll(){
  18   1              if(idx >= 4){
  19   2                      idx = 0;
  20   2              }
  21   1              P2 = cs[idx++];
  22   1      }
  23          
  24          //延时1
  25          void delay100ms(void) {
  26   1          uchar a,b,c;
  27   1          for(c=19;c>0;c--)
  28   1              for(b=20;b>0;b--)
  29   1                  for(a=130;a>0;a--);
  30   1      }
  31          
  32          //延时2
  33          void delay1s(void){
  34   1          uchar a,b,c;
  35   1          for(c=167;c>0;c--)
  36   1              for(b=171;b>0;b--)
  37   1                  for(a=16;a>0;a--);
  38   1          _nop_(); 
  39   1      }
  40          
  41          
  42          void main(){
  43   1              int i;
  44   1              lcd_simple_init();
  45   1      
  46   1              while(1){
  47   2      
  48   2                      char t;
  49   2                      uchar weight;
  50   2                      char str[5];
  51   2      
  52   2                      led_add = 1;
  53   2                      led_addend = 1;
  54   2      
C51 COMPILER V9.01   MAIN                                                                  05/07/2018 15:41:16 PAGE 2   

  55   2                      /*****************运送奶粉罐*****************/
  56   2                      lcd_display_string(1, 1, "1. Delivery pot");
  57   2                      lcd_display_string(2, 1, "time: 0s");
  58   2                      //输送奶粉罐的电机运行3s
  59   2                      for(i=0;i<31;i++){
  60   3                              //显示运行时间
  61   3                              if((i != 0) && ((t = i % 10) == 0)){
  62   4                                      lcd_display_string(2, 1, "time: ");
  63   4                                      lcd_display_char(2, 7, (i/10)+48);
  64   4                                      lcd_display_char(2, 8, 's');
  65   4                              }
  66   3              
  67   3                              //转动电机
  68   3                              roll();
  69   3                              delay100ms();
  70   3                      }
  71   2              
  72   2                      //奶粉罐到位
  73   2                      delay1s();
  74   2                      lcd_clear();
  75   2                      lcd_display_string(2, 1, "--Delivery End--");
  76   2              
  77   2                      /*****************输送奶粉*****************/
  78   2                      delay1s();
  79   2                      lcd_clear();
  80   2                      lcd_display_string(1, 1, "2. Putting milk");
  81   2                      led_add = 0;
  82   2                      led_addend = 1;
  83   2                      while(1){
  84   3                              roll();
  85   3                              delay100ms();
  86   3      
  87   3                              //丢弃几次转换
  88   3                              adc_transform();
  89   3                              adc_transform();
  90   3                              adc_transform();
  91   3      
  92   3                              weight = adc_transform();
  93   3                              lcd_display_string(2, 1, "weight: ");
  94   3                              sprintf(str, "%3d", (int)weight);
  95   3                              lcd_display_string(2, 9, str);
  96   3              
  97   3                              //重量达标
  98   3                              if(weight == 163){
  99   4                                      lcd_clear();
 100   4                                      lcd_display_string(2, 1, "--Putting End--");
 101   4                                      led_add = 1;
 102   4                                      led_addend = 0;
 103   4                                      break;                          
 104   4                              }
 105   3                      }
 106   2              
 107   2                      /*****************奶粉罐包装*****************/
 108   2                      delay1s();
 109   2                      lcd_clear();
 110   2                      lcd_display_string(1, 1, "3. Packing pot");
 111   2                      for(i=0;i<20;i++){
 112   3                              roll();
 113   3                              delay100ms();
 114   3                      }
 115   2                      lcd_clear();
 116   2                      lcd_display_string(2, 1, "--Packing End--");
C51 COMPILER V9.01   MAIN                                                                  05/07/2018 15:41:16 PAGE 3   

 117   2      
 118   2                      delay1s();
 119   2                      lcd_clear();
 120   2                      lcd_display_string(2, 1, "-----All End----");
 121   2              
 122   2              
 123   2                      //暂停3s循环执行
 124   2                      delay1s();
 125   2                      delay1s();
 126   2                      delay1s();
 127   2                      lcd_clear();            
 128   2              }
 129   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    427    ----
   CONSTANT SIZE    =    146    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C51 COMPILER V9.01   MAIN                                                                  05/23/2018 18:29:39 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Dev\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£º595¿ØÖÆ4ºº×ÖµãÕóÆÁ
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àĞ´£ºshifang
   5            ÈÕÆÚ£º2009.5
   6            ĞŞ¸Ä£ºÎŞ 51µ¥Æ¬»ú
   7            ÄÚÈİ£ºÆÁ+5V¡¢GNDÁ¬½ÓµçÔ´5V
   8                  P0.0-P0.3·Ö±ğÁ¬½ÓA¡¢B¡¢C¡¢D£¬ÓÃÓÚ¿ØÖÆ16ĞĞ£¬Í¨¹ı2Â·HC138¿ØÖÆ
   9                  SCKÊ±ÖÓÁ¬½ÓP2.5
  10                  LATCHËø´æÁ¬½ÓP2.6
  11                  R1ºìÉ«Êı¾İĞÅºÅÁ¬½ÓÖÁP2.4
  12                  G1ÂÌÉ«Êı¾İĞÅºÅÁ¬½ÓÖÁP0.4£¬Èç¹ûÊ¹ÓÃµ¥ºìÉ«ÆÁ´ËĞÅºÅÎŞĞèÁ¬½Ó
  13                  OEÊ¹ÄÜ¶ËÒ»°ã½ÓGND£¬¿ÉÒÔÓÃIOÒı½ÅPWM¿ØÖÆÁÁ¶È
  14                  »òÕßÊ¹ÓÃ´ËÒı½Å¿ØÖÆÍÏÎ²ÏÖÏó¡£
  15            ÏÖÏó£ºÊ¹ÓÃ¸ßËÙµ¥Æ¬»ú²âÊÔ£¬±ÈÈçSTC12C5A60S2¡£4¸öºº×ÖÏÔÊ¾ÆÁÆ´½Ó£¬Ïò×óÁ÷¶¯ÏÔÊ¾¶à¾ä»°£¬ÖØ¸´Ñ­»·ÏÔÊ¾¡£
  16          ------------------------------------------------*/
  17          #include<reg52.h>
  18          #include "uart.h"
  19          
  20          #define uchar unsigned char
  21          
  22          sbit T_STR = P2^6;       //Ëø´æÒı½Å£¬ÆÁÉÏ±êÊ¶Î»STR
  23          sbit R1    = P2^4;       //Êı¾İÒı½Å£¬ÆÁÉÏ±êÊ¶R1
  24          sbit G1    = P0^4;       //Êı¾İÒı½Å£¬ÆÁÉÏ±êÊ¶G1
  25          sbit T_CLK = P2^5;       //Ê±ÖÓÒı½Å£¬ÆÁÉÏ±êÊ¶Î»CLK
  26          sbit OE    = P2^1;       //Ê¹ÄÜÒı½Å£¬ÆÁÉÏ±êÊ¶EN/OE
  27          
  28          unsigned char MoveBitNum,MoveBitNumtemp,IncNum;//ÒÆ¶¯Î»Êı,ÁÙÊ±ÒÆ¶¯Î»Êı£¬´óÓÚÒ»¸ö×Ö½ÚÔö¼Ó×Ö½ÚÊı
  29          unsigned int HzNum = 0;//ºº×Ö¸öÊı
  30          unsigned char buff[10];
  31          
  32          uchar xdata hztest[20][32];
  33          uchar word_num = 10;
  34          
  35          static void clear(){
  36   1              uchar k, s;
  37   1              for(s=0;s<100;s++){
  38   2                      for(k=0;k<32;k++){
  39   3                              hztest[s][k] = 0;
  40   3                      }
  41   2              }
  42   1      }
  43          
  44          uchar word = 0;
  45          uchar idx = 0;
  46          uchar last;
  47          bit work = 0;
  48          
  49          void uart_received(uchar dat){
  50   1      //      unsigned char k, s;     
  51   1      //      for(s=0;s<8;s++){
  52   1      //              
  53   1      //              for(k=0;k<32;k++){
  54   1      //                      hztest[s][k] = ff[s][k];
  55   1      //              }
C51 COMPILER V9.01   MAIN                                                                  05/23/2018 18:29:39 PAGE 2   

  56   1      //              
  57   1      //      }
  58   1      
  59   1              if(last == 0x55 && dat == 0xaa){
  60   2                      work = 1;
  61   2              }
  62   1              if(last == 0xaa && dat == 0x55){
  63   2                      work = 0;
  64   2                      word = 0;
  65   2                      idx = 0;
  66   2                      word_num = 10;
  67   2      
  68   2                      clear();
  69   2              }
  70   1                      
  71   1      
  72   1              last = dat;
  73   1      
  74   1              hztest[word][idx++] = dat;
  75   1              if(idx >= 32){
  76   2                      idx = 0;
  77   2                      word++;
  78   2                      //word_num++;
  79   2              }
  80   1      }
  81          
  82          
  83          /*-----------------------------------------------
  84                       Ïò595Ğ´ÈëÒ»¸ö×Ö½Ú µ¥ºìÉ«
  85          ------------------------------------------------*/
  86          void InputByte( unsigned  char DataR1){ 
  87   1              unsigned char i;
  88   1              for(i=8; i>0; i--){
  89   2                      R1 = !(DataR1&0x01);                   
  90   2                      T_CLK = 0;
  91   2                      T_CLK = 1;
  92   2                      DataR1 = DataR1 >> 1; 
  93   2              } 
  94   1      }
  95          /*-----------------------------------------------
  96                       Ïò595Ğ´ÈëÁ½¸ö×Ö½Ú Ë«É«
  97          ------------------------------------------------*/
  98          void Input2Byte( unsigned  char DataR1,unsigned  char DataG1){ 
  99   1              unsigned  char i;
 100   1              for(i=8; i>0; i--){
 101   2                      R1 = !(DataR1&0x01);    
 102   2                      G1 = !(DataG1&0x01);                
 103   2                      T_CLK = 0;
 104   2                      T_CLK = 1;
 105   2                      DataR1 = DataR1 >> 1; 
 106   2                      DataG1 = DataG1 >> 1; 
 107   2              } 
 108   1      }
 109          
 110          
 111          /*-----------------------------------------------
 112                              ÑÓÊ±³ÌĞò
 113          ------------------------------------------------*/
 114          void Delay(unsigned int t){
 115   1              while(--t);
 116   1      }
 117          
C51 COMPILER V9.01   MAIN                                                                  05/23/2018 18:29:39 PAGE 3   

 118          
 119          /*-----------------------------------------------
 120                                Ö÷³ÌĞò
 121          ------------------------------------------------*/
 122          void main(){
 123   1      
 124   1      unsigned char count;//16ĞĞÉ¨ÃèÊı¾İ£¬·¶Î§0-15
 125   1       unsigned int i,  j;
 126   1       unsigned char temp;
 127   1      
 128   1              //³õÊ¼»¯
 129   1              clear();
 130   1      
 131   1              uart_init();
 132   1      
 133   1              
 134   1                 while(1){
 135   2      if(work)
 136   2      {
 137   3       
 138   3      
 139   3       i++;
 140   3       if(i==30)//¸ü¸ÄÁ÷¶¯ËÙ¶È,1Tµ¥Æ¬»úºÍ12Tµ¥Æ¬»úËÙ¶È´óÔ¼5-8±¶£¬×¢Òâ¸ü¸Ä²ÎÊı
 141   3         {
 142   4         i=0;
 143   4         MoveBitNum++;
 144   4       if(MoveBitNum==16)//Ã¿´ÎÒÆ¶¯ÍêÒ»¸öºº×Ö´óĞ¡ºóÑ­»·
 145   4          {
 146   5            MoveBitNum=0;
 147   5                HzNum+=1;    //µ÷ÓÃÏÂÒ»¸öºº×Ö
 148   5                if(HzNum>=word_num)//ĞèÒªÏÔÊ¾µÄºº×Ö¸öÊı£¬°üÀ¨Ç°ÃæµÄÒ»ÆÁ¿Õ×Ö·ûµÄ¸öÊı£¬ºóÃæÇåÆÁµÄ¿Õ×Ö·û²»°üº¬ÔÚÄÚ,ÕâÀïÊÇ(
             -ºº×Ö¸öÊı+4)
 149   5                   HzNum=0;   //ÍêÈ«ÏÔÊ¾ÍêºóÑ­»·µ÷ÓÃ
 150   5          }
 151   4        }
 152   3      
 153   3      
 154   3       Delay(30);//¿ØÖÆÉ¨ÃèÆµÂÊ
 155   3       for(j=0;j<5;j++) //È¡Ã¿¸öºº×ÖµÄÇ°2¸ö×Ö½Ú£¬4¸öºº×Ö×é³ÉÒ»ĞĞ£¬Êı¾İ´«ÊäÍê³ÉºóËø´æÊä³ö¼´¿É£¬ÕâÀïĞèÒª¶àÈ¡³öÒ»¸ö
             -ºº×Ö×÷Îª»º³å
 156   3              {                //Ô­À´j=4£¬ÏÖÔÚj=5.
 157   4               buff[j+j]=hztest[HzNum+j][count+count];  //Ã¿´ÎÒÆ¶¯ÍêÒ»¸öºº×Öºó£¬Ñ¡ÔñÏÂÒ»¸öºº×Ö
 158   4               buff[j+j+1]=hztest[HzNum+j][count+count+1];
 159   4              }
 160   3      
 161   3        if(MoveBitNum<8)                   //  ÅĞ¶ÁÒÆ¶¯¾àÀëÊÇ´óÓÚÒ»¸ö×Ö½Ú»¹ÊÇĞ¡ÓÚÒ»¸ö×Ö½Ú£¬ÒòÎªÒ»¸ö×Ö½Ú×óÒÆÓÒÒÆ×
             -î´óÖ»ÄÜ8Î»
 162   3                { IncNum=0; MoveBitNumtemp=MoveBitNum; }
 163   3        else
 164   3                { IncNum=1; MoveBitNumtemp=MoveBitNum-8;}//´óÓÚ8¾Í¼õÈ¥8µÃµ½µÄÊıÖµ»¹ÊÇĞ¡ÓÚ8
 165   3       T_STR=0;       //Ëø´æÎŞĞ§
 166   3        for(j=0;j<8;j++)          //°´bitµÄ·½Ê½ÒÆ¶¯»º³åÇøµÄÄÚÈİ£¬È»ºóÊä³öµ½595£¬¼´È¡³öµÄÊıÖµÃ¿¸ö×Ö½Ú×óÒÆÒ»¶¨µÄÎ»
             -Êı£¬
 167   3                {                                     //ºóÃæ×óÒÆ³öµÄÊı¾İÕûºÏµ½Ç°ÃæµÄ×Ö½ÚÖĞ£¬±£³ÖÊı¾İµÄÁ¬ĞøĞÔ       
 168   4                 temp=(buff[j+IncNum]>>MoveBitNumtemp)|(buff[j+1+IncNum]<<(8-MoveBitNumtemp));//Õâ¾ä±È½ÏÖØÒª£¬ĞèÒª×ÔĞĞÄ
             -Ã³ö2¸ö×Ö½ÚµÄÊı¾İÄ£Äâ·ÖÎö
 169   4             Input2Byte(temp,temp);//Êä³öµ½595
 170   4                }//8¸ö×Ö½Ú´«ÊäÍêËø´æÊä³ö
 171   3       OE = 1;
 172   3       P0=count;//ÓÃP0¿ÚµÄÇ°4Î»¿ØÖÆ16ĞĞ£¬ÆÁÄÚ²¿Í¨¹ı4-16ÒëÂëÆ÷¹¤×÷£¬Ñ­»·É¨Ãè16ĞĞ
 173   3       T_STR=1;      //Ëø´æÓĞĞ§£¬´ËÊ±Ò»ĞĞµÄÊı¾İÏÔÊ¾µ½ÆÁÉÏ
 174   3       OE = 0;
C51 COMPILER V9.01   MAIN                                                                  05/23/2018 18:29:39 PAGE 4   

 175   3       
 176   3       count++;
 177   3       if(count==16)
 178   3          count=0;
 179   3       }
 180   2               }
 181   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    477    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    640    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
